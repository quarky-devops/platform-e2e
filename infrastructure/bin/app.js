#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
require("source-map-support/register");
const cdk = require("aws-cdk-lib");
const vpc_stack_1 = require("../lib/vpc-stack");
const security_stack_1 = require("../lib/security-stack");
const database_stack_1 = require("../lib/database-stack");
const app_stack_1 = require("../lib/app-stack");
const auth_stack_1 = require("../lib/auth-stack");
const cdn_stack_1 = require("../lib/cdn-stack");
const app = new cdk.App();
// Environment configuration
const env = {
    account: process.env.CDK_DEFAULT_ACCOUNT,
    region: process.env.CDK_DEFAULT_REGION || 'us-east-1',
};
const projectName = 'quarkfin';
const environment = 'production';
// Core infrastructure stacks
const vpcStack = new vpc_stack_1.QuarkfinVpcStack(app, 'QuarkfinVpcStack', {
    env,
    projectName,
    environment,
});
const securityStack = new security_stack_1.QuarkfinSecurityStack(app, 'QuarkfinSecurityStack', {
    env,
    projectName,
    environment,
    vpc: vpcStack.vpc,
});
const authStack = new auth_stack_1.QuarkfinAuthStack(app, 'QuarkfinAuthStack', {
    env,
    projectName,
    environment,
});
const databaseStack = new database_stack_1.QuarkfinDatabaseStack(app, 'QuarkfinDatabaseStack', {
    env,
    projectName,
    environment,
    vpc: vpcStack.vpc,
    databaseSecurityGroup: securityStack.databaseSecurityGroup,
});
const appStack = new app_stack_1.QuarkfinAppStack(app, 'QuarkfinAppStack', {
    env,
    projectName,
    environment,
    vpc: vpcStack.vpc,
    database: databaseStack.database,
    userPool: authStack.userPool,
    appSecurityGroup: securityStack.appSecurityGroup,
    albSecurityGroup: securityStack.albSecurityGroup,
});
const cdnStack = new cdn_stack_1.QuarkfinCdnStack(app, 'QuarkfinCdnStack', {
    env,
    projectName,
    environment,
    loadBalancer: appStack.loadBalancer,
});
// Add tags to all resources
cdk.Tags.of(app).add('Project', 'QuarkfinAI');
cdk.Tags.of(app).add('Environment', 'production');
cdk.Tags.of(app).add('ManagedBy', 'CDK');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHVDQUFxQztBQUNyQyxtQ0FBbUM7QUFDbkMsZ0RBQW9EO0FBQ3BELDBEQUE4RDtBQUM5RCwwREFBOEQ7QUFDOUQsZ0RBQW9EO0FBQ3BELGtEQUFzRDtBQUN0RCxnREFBb0Q7QUFFcEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFFMUIsNEJBQTRCO0FBQzVCLE1BQU0sR0FBRyxHQUFHO0lBQ1YsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CO0lBQ3hDLE1BQU0sRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixJQUFJLFdBQVc7Q0FDdEQsQ0FBQztBQUVGLE1BQU0sV0FBVyxHQUFHLFVBQVUsQ0FBQztBQUMvQixNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUM7QUFFakMsNkJBQTZCO0FBQzdCLE1BQU0sUUFBUSxHQUFHLElBQUksNEJBQWdCLENBQUMsR0FBRyxFQUFFLGtCQUFrQixFQUFFO0lBQzdELEdBQUc7SUFDSCxXQUFXO0lBQ1gsV0FBVztDQUNaLENBQUMsQ0FBQztBQUVILE1BQU0sYUFBYSxHQUFHLElBQUksc0NBQXFCLENBQUMsR0FBRyxFQUFFLHVCQUF1QixFQUFFO0lBQzVFLEdBQUc7SUFDSCxXQUFXO0lBQ1gsV0FBVztJQUNYLEdBQUcsRUFBRSxRQUFRLENBQUMsR0FBRztDQUNsQixDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVMsR0FBRyxJQUFJLDhCQUFpQixDQUFDLEdBQUcsRUFBRSxtQkFBbUIsRUFBRTtJQUNoRSxHQUFHO0lBQ0gsV0FBVztJQUNYLFdBQVc7Q0FDWixDQUFDLENBQUM7QUFFSCxNQUFNLGFBQWEsR0FBRyxJQUFJLHNDQUFxQixDQUFDLEdBQUcsRUFBRSx1QkFBdUIsRUFBRTtJQUM1RSxHQUFHO0lBQ0gsV0FBVztJQUNYLFdBQVc7SUFDWCxHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUc7SUFDakIscUJBQXFCLEVBQUUsYUFBYSxDQUFDLHFCQUFxQjtDQUMzRCxDQUFDLENBQUM7QUFFSCxNQUFNLFFBQVEsR0FBRyxJQUFJLDRCQUFnQixDQUFDLEdBQUcsRUFBRSxrQkFBa0IsRUFBRTtJQUM3RCxHQUFHO0lBQ0gsV0FBVztJQUNYLFdBQVc7SUFDWCxHQUFHLEVBQUUsUUFBUSxDQUFDLEdBQUc7SUFDakIsUUFBUSxFQUFFLGFBQWEsQ0FBQyxRQUFRO0lBQ2hDLFFBQVEsRUFBRSxTQUFTLENBQUMsUUFBUTtJQUM1QixnQkFBZ0IsRUFBRSxhQUFhLENBQUMsZ0JBQWdCO0lBQ2hELGdCQUFnQixFQUFFLGFBQWEsQ0FBQyxnQkFBZ0I7Q0FDakQsQ0FBQyxDQUFDO0FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSw0QkFBZ0IsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLEVBQUU7SUFDN0QsR0FBRztJQUNILFdBQVc7SUFDWCxXQUFXO0lBQ1gsWUFBWSxFQUFFLFFBQVEsQ0FBQyxZQUFZO0NBQ3BDLENBQUMsQ0FBQztBQUVILDRCQUE0QjtBQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQzlDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7QUFDbEQsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcbmltcG9ydCAnc291cmNlLW1hcC1zdXBwb3J0L3JlZ2lzdGVyJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBRdWFya2ZpblZwY1N0YWNrIH0gZnJvbSAnLi4vbGliL3ZwYy1zdGFjayc7XG5pbXBvcnQgeyBRdWFya2ZpblNlY3VyaXR5U3RhY2sgfSBmcm9tICcuLi9saWIvc2VjdXJpdHktc3RhY2snO1xuaW1wb3J0IHsgUXVhcmtmaW5EYXRhYmFzZVN0YWNrIH0gZnJvbSAnLi4vbGliL2RhdGFiYXNlLXN0YWNrJztcbmltcG9ydCB7IFF1YXJrZmluQXBwU3RhY2sgfSBmcm9tICcuLi9saWIvYXBwLXN0YWNrJztcbmltcG9ydCB7IFF1YXJrZmluQXV0aFN0YWNrIH0gZnJvbSAnLi4vbGliL2F1dGgtc3RhY2snO1xuaW1wb3J0IHsgUXVhcmtmaW5DZG5TdGFjayB9IGZyb20gJy4uL2xpYi9jZG4tc3RhY2snO1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuXG4vLyBFbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG5jb25zdCBlbnYgPSB7XG4gIGFjY291bnQ6IHByb2Nlc3MuZW52LkNES19ERUZBVUxUX0FDQ09VTlQsXG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfUkVHSU9OIHx8ICd1cy1lYXN0LTEnLFxufTtcblxuY29uc3QgcHJvamVjdE5hbWUgPSAncXVhcmtmaW4nO1xuY29uc3QgZW52aXJvbm1lbnQgPSAncHJvZHVjdGlvbic7XG5cbi8vIENvcmUgaW5mcmFzdHJ1Y3R1cmUgc3RhY2tzXG5jb25zdCB2cGNTdGFjayA9IG5ldyBRdWFya2ZpblZwY1N0YWNrKGFwcCwgJ1F1YXJrZmluVnBjU3RhY2snLCB7XG4gIGVudixcbiAgcHJvamVjdE5hbWUsXG4gIGVudmlyb25tZW50LFxufSk7XG5cbmNvbnN0IHNlY3VyaXR5U3RhY2sgPSBuZXcgUXVhcmtmaW5TZWN1cml0eVN0YWNrKGFwcCwgJ1F1YXJrZmluU2VjdXJpdHlTdGFjaycsIHtcbiAgZW52LFxuICBwcm9qZWN0TmFtZSxcbiAgZW52aXJvbm1lbnQsXG4gIHZwYzogdnBjU3RhY2sudnBjLFxufSk7XG5cbmNvbnN0IGF1dGhTdGFjayA9IG5ldyBRdWFya2ZpbkF1dGhTdGFjayhhcHAsICdRdWFya2ZpbkF1dGhTdGFjaycsIHtcbiAgZW52LFxuICBwcm9qZWN0TmFtZSxcbiAgZW52aXJvbm1lbnQsXG59KTtcblxuY29uc3QgZGF0YWJhc2VTdGFjayA9IG5ldyBRdWFya2ZpbkRhdGFiYXNlU3RhY2soYXBwLCAnUXVhcmtmaW5EYXRhYmFzZVN0YWNrJywge1xuICBlbnYsXG4gIHByb2plY3ROYW1lLFxuICBlbnZpcm9ubWVudCxcbiAgdnBjOiB2cGNTdGFjay52cGMsXG4gIGRhdGFiYXNlU2VjdXJpdHlHcm91cDogc2VjdXJpdHlTdGFjay5kYXRhYmFzZVNlY3VyaXR5R3JvdXAsXG59KTtcblxuY29uc3QgYXBwU3RhY2sgPSBuZXcgUXVhcmtmaW5BcHBTdGFjayhhcHAsICdRdWFya2ZpbkFwcFN0YWNrJywge1xuICBlbnYsXG4gIHByb2plY3ROYW1lLFxuICBlbnZpcm9ubWVudCxcbiAgdnBjOiB2cGNTdGFjay52cGMsXG4gIGRhdGFiYXNlOiBkYXRhYmFzZVN0YWNrLmRhdGFiYXNlLFxuICB1c2VyUG9vbDogYXV0aFN0YWNrLnVzZXJQb29sLFxuICBhcHBTZWN1cml0eUdyb3VwOiBzZWN1cml0eVN0YWNrLmFwcFNlY3VyaXR5R3JvdXAsXG4gIGFsYlNlY3VyaXR5R3JvdXA6IHNlY3VyaXR5U3RhY2suYWxiU2VjdXJpdHlHcm91cCxcbn0pO1xuXG5jb25zdCBjZG5TdGFjayA9IG5ldyBRdWFya2ZpbkNkblN0YWNrKGFwcCwgJ1F1YXJrZmluQ2RuU3RhY2snLCB7XG4gIGVudixcbiAgcHJvamVjdE5hbWUsXG4gIGVudmlyb25tZW50LFxuICBsb2FkQmFsYW5jZXI6IGFwcFN0YWNrLmxvYWRCYWxhbmNlcixcbn0pO1xuXG4vLyBBZGQgdGFncyB0byBhbGwgcmVzb3VyY2VzXG5jZGsuVGFncy5vZihhcHApLmFkZCgnUHJvamVjdCcsICdRdWFya2ZpbkFJJyk7XG5jZGsuVGFncy5vZihhcHApLmFkZCgnRW52aXJvbm1lbnQnLCAncHJvZHVjdGlvbicpO1xuY2RrLlRhZ3Mub2YoYXBwKS5hZGQoJ01hbmFnZWRCeScsICdDREsnKTtcbiJdfQ==